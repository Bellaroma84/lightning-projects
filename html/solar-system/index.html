<html>
    <head>
        <title>Solar System</title>
        <style>
            * {
                font-family: monospace;
            }
            .center {
                text-align: center;
            }
            .planet {
                border-radius: 50%;
                width: 100px;
                height: 100px;
                background-color: red;
            }
        </style>
    </head>
    <body onload="init()">
        <div class="center">
            <h1>Solar System</h1>
        </div>
        <div class="center">
            <svg id="solar-system" width="1600" height="1600" style="border: 1px solid black;">
                <g id="sun" transform="translate(500, 500)">
                    <circle id="sun-circle" r="50" fill="#fcca03" />
                    <!-- <rect id="rect-circle" x="0" y="70" width="7" height="20" fill="black"/> -->
                </g>
                <g id="mercury" transform="translate(500, 600)">
                    <circle id="mercury-circle" r="10.09" fill="silver" />
                </g>
                <g id="venus" transform="translate(500, 654)">
                    <circle id="venus-circle" r="16.5" fill="silver" />
                </g>
                <g id="earth" transform="translate(500, 682)">
                    <circle id="earth-circle" r="16.9" fill="silver" />
                </g>
                <g id="mars" transform="translate(500, 718.5)">
                    <circle id="mars-circle" r="12.4" fill="silver" />
                </g>
                <g id="jupiter" transform="translate(500, 824.75)">
                    <circle id="jupiter-circle" r="33.9" fill="silver" />
                </g>
                <g id="saturn" transform="translate(500, 877.8)">
                    <circle id="saturn-circle" r="32.731" fill="silver" />
                </g>
                <g id="uranus" transform="translate(500, 937.8)">
                    <circle id="uranus-circle" r="26.677" fill="silver" />
                </g>
                <g id="neptune" transform="translate(500, 976.8)">
                    <circle id="neptune-circle" r="26.4" fill="silver" />
                </g>
                <g id="pluto" transform="translate(500, 1000)">
                    <circle id="pluto-circle" r="5.0" fill="brown" />
                </g>
            </svg>
        </div>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.0/anime.min.js"></script>
        <script>
            let time = 1.0;
            let solarSystem;
            let timer;

            function init() {
                solarSystem = initSolarSystem();
                timer = setInterval(orbit, 100);
            }

            function orbit() {
                const center = solarSystem.center;
                solarSystem.planets.forEach(p => {
                    const c = p.tick(time);
                    const x = c.get('x');
                    const y = c.get('y');

                    const gId = `${p.name}`;
                    const g = document.getElementById(gId);
                    g.setAttribute('transform', `translate(${x}, ${y})`);
                });
                time += 100.0;
                console.log(time);
            }

            function initSolarSystem() {
                function getPoint(theta, center, r, n=3600.0) {
                    const x = center.x + Math.cos(2.0 * Math.PI / n * theta) * r;
                    const y = center.y + Math.sin(2.0 * Math.PI / n * theta) * r;
                    const m = new Map();
                    m.set('x', x);
                    m.set('y', y);
                    return {theta: theta, coordinate: m};
                }

                function getPoints(delta, center, r, n=3600.0) {
                    const points = Array();
                    for (let i = 0; i < n; i += 1.0) {
                        const point = getPoint(i * delta, center, r);

                        points.push(point.coordinate);
                    }
                    return points;
                }

                const width = document.getElementById('solar-system').getAttribute('width');
                const height = document.getElementById('solar-system').getAttribute('height');
                const cx = width / 2.0;
                const cy = height / 2.0;

                document.getElementById('sun').setAttribute('transform', `translate(${cx}, ${cy})`)

                const planets = getPlanets();

                const pDiam = getDiamScalingParams();
                const pDist = getDistScalingParams();

                planets.forEach(p => {
                    p.normDiam = rescale(Math.log(p.diameter), pDiam.a, pDiam.b, pDiam.min, pDiam.max);
                    p.x = rescale(Math.log(p.distance), pDist.a, pDist.b, pDist.min, pDist.max) + cx;
                    p.y = cy;
                    p.normDist = Math.sqrt(Math.pow(p.x - cx, 2.0) + Math.pow(p.y - cy, 2.0));
                    p.theta = 360.0 / p.orbitalPeriod;
                    p.delta = 360.0 / p.orbitalPeriod;
                    p.points = getPoints(p.delta, {x: cx, y: cy}, p.normDist);
                    p.cx = cx;
                    p.cy = cy;
                });

                console.table(planets);

                planets.forEach(p => {
                    const gId = `${p.name}`;
                    const g = document.getElementById(gId);
                    g.setAttribute('transform', `translate(${p.x}, ${p.y})`);

                    const circleId = `${p.name}-circle`;
                    const circle = document.getElementById(circleId);
                    circle.setAttribute('r', `${p.normDiam}`);
                    circle.setAttribute('fill', `${p.color}`);
                });

                return {
                    planets: planets,
                    center: {x: cx, y: cy}
                };
            }

            function getDiamScalingParams(a = 5, b = 50) {
                const planets = getPlanets();

                const diams = planets.map(p => Math.log(p.diameter));
                diams.push(Math.log(1391982.78));

                let min = Math.min(...diams);
                let max = Math.max(...diams);
                return {a: a, b: b, min: min, max: max};
            }

            function getDistScalingParams(a = 75, b = 750) {
                const planets = getPlanets();

                const dists = planets.map(p => Math.log(p.distance));
                const min = Math.min(...dists);
                const max = Math.max(...dists);
                return {a: a, b: b, min: min, max: max};
            }

            function rescale(x, a, b, min, max) {
                return (b - a) * (x - min) / (max - min) + a;
            }

            function getPlanets() {
                const sunDiameter = 1391982.78;
                const planets = [
                    getPlanet('mercury', 4879.0, 57.9, 1407.6, 88.0, '#9ea5b0'),
                    getPlanet('venus', 12104.0, 108.2, -5832.5, 224.7, '#3db536'),
                    getPlanet('earth', 12756.0, 149.6, 23.9, 365.2, '#0b56e0'),
                    getPlanet('mars', 6792.0, 227.9, 24.6, 687.0, '#ff6b4a'),
                    getPlanet('jupiter', 142984.0, 778.6, 9.9, 4331.0, '#e6a009'),
                    getPlanet('saturn', 120536.0, 1433.5, 10.7, 10747.0, '#dfe374'),
                    getPlanet('uranus', 51118.0, 2872.5, -17.2, 30589.0, '#63db8f'),
                    getPlanet('neptune', 49528.0, 4495.1, 16.1, 59800.0, '#63a1db'),
                    getPlanet('pluto', 2370.0, 5906.4, -153.3, 90560.0, '#ad935a'),
                ];

                return planets;
            }

            function getPlanet(name, diameter, distance, rotationPeriod, orbitalPeriod, color) {
                return {
                    name: name,
                    diameter: diameter,
                    distance: distance,
                    rotationPeriod: rotationPeriod,
                    orbitalPeriod: orbitalPeriod,
                    color: color,
                    tick: function(time) {
                        const delta = 360.0 / this.orbitalPeriod;
                        const theta = time * delta;
                        const r = this.normDist;
                        const cx = this.cx;
                        const cy = this.cy;

                        const x = cx + Math.cos(2.0 * Math.PI / 3600.0 * theta) * r;
                        const y = cy + Math.sin(2.0 * Math.PI / 3600.0 * theta) * r;
                        
                        const m = new Map();
                        m.set('x', x);
                        m.set('y', y);
                        return m;
                    }
                };
            }
        </script>
    </body>
</html>